\epi{%
\begin{itemize}
\item{Parallelism is about performace;}
\item{Concurrency is about program design.}
\end{itemize}%
}{\textit{Google IO 2010}\\\textsc{Robe Pike}}
\noindent{}In this chapter we will show off Go's ability for
concurrent programming using channels and goroutines. Goroutines
are the central entity in Go's ability for concurrency. But what
\emph{is} a goroutines? From \cite{effective_go}:
\begin{quote}
They're called goroutines because the existing terms --- threads, coroutines,
processes, and so on --- convey inaccurate connotations. A goroutine has a simple
model: \emph{it is a function executing in parallel with other goroutines in the same
address space}. It is lightweight, costing little more than the allocation of
stack space. And the stacks start small, so they are cheap, and grow by
allocating (and freeing) heap storage as required.
\end{quote}

The following idea for a program was taken from \cite{curso_go}. 
\lstinputlisting[numbers=right,label=src:sleeping,caption=Go routines in action,linerange={8,18}]{src/sleep.go}
We run a function as two goroutines, the goroutines wait for an amount of
time and them print something to the screen. The \func{main} function
waits long enough so that both goroutines have printed their text. Right
now we wait for 5 seconds (\func{time.Sleep()} counts in ns) on line 18, but in fact we have no idea how
long we should wait until all goroutines have exited.

What we need here is some kind of mechanism which allows us to
communicate with the goroutines we start. This mechanism is available
to use in the form of \first{channels}. A \first{channel} can be
compared as a two-way pipe in Unix. You can send and receive
values to and from it.

\begin{lstlisting}[caption=Go routines and a channel,label=src:sleeping with channels]
var c chan int |\longremark{Declare \var{c} to be a variable that is a %
channel of \type{int}s. That is: this channel can move integers;}|

func ready(w string, sec int) {
	time.Sleep(int64(sec) * 1e9)
	fmt.Println(w, "is ready!")
	c <- 1	|\longremark{Send the integer 1 on the channel \var{c};}|
}

func main() {i
	c = make(chan int) |\longremark{Initialize \var{c}, note that we must use \func{make} here;}|
	go ready("Tee", 2) |\longremark{Start the goroutines as usual;}|
	go ready("Coffee", 1)
	fmt.Println("I'm waiting, but not too long")
	<-c |\longremark{Wait until we receive a value from the channel. Note that the value we receive is discarded;}|
	<-c |\longremark{Two goroutines, two values to receive.}|
}
\end{lstlisting}
\showremarks

\todo{select}

\section{Exercises}
\input{ex-channels/ex-for-channels.tex}

\input{ex-channels/ex-fib.tex}

\cleardoublepage
\section{Answers}
\shipoutAnswer
