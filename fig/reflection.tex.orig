<<<<<<< HEAD
\begin{lstlisting}[caption=使用反射自省,label=src:introspection]
=======
\begin{lstlisting}[caption=Introspection using reflection,label=src:introspection]
>>>>>>> 9d3c4dbbba2dd6ce9e8c33dbfcbd0d7ca7842eb7
|\begin{tikzpicture}[overlay]
\ubrace{3.2,-5.2}{2.2,-5.2}{%
We are dealing with a \type{Type} and according %
to the documentation\footnote{\texttt{go doc reflect}}:%
\begin{quote} %
// Elem returns a type's element type. \\ %
// It panics if the type's Kind is not Array, Chan, Map, Ptr, or Slice.\\ %
\func{Elem() Type} %
\end{quote} %
<<<<<<< HEAD
同样的在 \var{t} 使用 \func{Elem()} 得到了指针指向的值。}
\ubrace{4.7,-5.2}{3.6,-5.2}{We have now dereferened the pointer %
=======
So on \var{t} we use \func{Elem()} to get the value the pointer %
points to;}%
\ubrace{4.7,-5.2}{3.6,-5.2}{We have now dereferenced the pointer %
>>>>>>> 9d3c4dbbba2dd6ce9e8c33dbfcbd0d7ca7842eb7
and are "inside" our structure. %
We now use \func{Field(0)} to access the zeroth field;}%
%
\ubrace{5.4,-5.2}{4.8,-5.2}{%
<<<<<<< HEAD
结构 \type{StructField} 有成员 \var{Tag}，返回字符串类型的标签名。%
因此，在第 $0^{th}$ 个字段上可以用 \func{.Tag} 访问这个名字：\texttt{Field(0).Tag}。%
这样得到了 \texttt{namestr}。}
\end{tikzpicture}|
type Person struct {
    name string "namestr" |\coderemark{\texttt{"namestr"} 是标签}|
    age  int
}

p1 := new(Person)   |\coderemark{\func{new} 返回 Person 的指针}|
ShowTag(p1)	    |\coderemark{调用 \func{ShowTag()} 并传递指针}|

func ShowTag(i interface{}) {

 switch t := reflect.TypeOf(i); t.Kind() { |\coderemark{Get type, switch on Kind()}|
 case reflect.Ptr:       |\coderemark{Its a pointer, hence a \var{reflect.Ptr}}|
       tag := t.Elem().Field(0).Tag
||
\end{lstlisting}
Elem 返回 v 指向的值。%
如果 v 是空指针，Elem 返回空值。%
=======
The struct \type{StructField} has a \var{Tag} member which %
returns the tag-name as a string. So on the $0^{th}$ field we can %
unleash \func{.Tag} to access this name: \texttt{Field(0).Tag}. This %
gives us \texttt{namestr}.}
%
\end{tikzpicture}|
type Person struct {
    name string "namestr" |\coderemark{\texttt{"namestr"} is the tag}|
    age  int
}

p1 := new(Person)   |\coderemark{\func{new} returns a pointer to Person}|
ShowTag(p1)	    |\coderemark{\func{ShowTag()} is now called with this pointer}|

func ShowTag(i interface{}) {
 switch t := reflect.TypeOf(i); t.Kind() { |\coderemark{Get type, switch on Kind()}|
 case reflect.Ptr:	  |\coderemark{Its a pointer, hence a \var{reflect.Ptr}}|
	tag := t.Elem().Field(0).Tag
\end{lstlisting}
>>>>>>> 9d3c4dbbba2dd6ce9e8c33dbfcbd0d7ca7842eb7
